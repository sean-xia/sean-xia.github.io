<!DOCTYPE html>
<html data-color-mode="light" data-dark-theme="dark" data-light-theme="light" lang="zh-CN">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />
    
    <link rel="icon" href="https://github.githubassets.com/favicons/favicon.svg"><script>
        let theme = localStorage.getItem("meek_theme") || "light";
        document.documentElement.setAttribute("data-color-mode", theme);
    </script>
<meta name="description" content="

本教程由作者**xhx** 与 **Claud 3.7 Sonnet**  共同创作完成。">
<meta property="og:title" content="伪分布式大数据开发环境搭建指南V1.0">
<meta property="og:description" content="

本教程由作者**xhx** 与 **Claud 3.7 Sonnet**  共同创作完成。">
<meta property="og:type" content="article">
<meta property="og:url" content="http://sean-xia.github.io/post/wei-fen-bu-shi-da-shu-ju-kai-fa-huan-jing-da-jian-zhi-nan-V1.0.html">
<meta property="og:image" content="https://github.githubassets.com/favicons/favicon.svg">
<title>伪分布式大数据开发环境搭建指南V1.0</title>
<link href="//unpkg.com/@wooorm/starry-night@2.1.1/style/both.css" rel="stylesheet" />


</head>
<style>
body{box-sizing: border-box;min-width: 200px;max-width: 900px;margin: 20px auto;padding: 45px;font-size: 16px;font-family: sans-serif;line-height: 1.25;}
#header{display:flex;padding-bottom:8px;border-bottom: 1px solid var(--borderColor-muted, var(--color-border-muted));margin-bottom: 16px;}
#footer {margin-top:64px; text-align: center;font-size: small;}

</style>

<style>
.postTitle{margin: auto 0;font-size:40px;font-weight:bold;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}
#postBody{border-bottom: 1px solid var(--color-border-default);padding-bottom:36px;}
#postBody hr{height:2px;}
#cmButton{height:48px;margin-top:48px;}
#comments{margin-top:64px;}
.g-emoji{font-size:24px;}
@media (max-width: 600px) {
    body {padding: 8px;}
    .postTitle{font-size:24px;}
}
.copy-feedback {
    display: none;
    position: absolute;
    top: 10px;
    right: 50px;
    color: var(--color-fg-on-emphasis);
    background-color: var(--color-fg-muted);
    border-radius: 3px;
    padding: 5px 8px;
    font-size: 12px;
}
</style>




<body>
    <div id="header">
<h1 class="postTitle">伪分布式大数据开发环境搭建指南V1.0</h1>
<div class="title-right">
    <a href="http://sean-xia.github.io" id="buttonHome" class="btn btn-invisible circle" title="首页">
        <svg class="octicon" width="16" height="16">
            <path id="pathHome" fill-rule="evenodd"></path>
        </svg>
    </a>
    
    <a href="https://github.com/sean-xia/sean-xia.github.io/issues/18" target="_blank" class="btn btn-invisible circle" title="Issue">
        <svg class="octicon" width="16" height="16">
            <path id="pathIssue" fill-rule="evenodd"></path>
        </svg>
    </a>
    

    <a class="btn btn-invisible circle" onclick="modeSwitch();" title="切换主题">
        <svg class="octicon" width="16" height="16" >
            <path id="themeSwitch" fill-rule="evenodd"></path>
        </svg>
    </a>

</div>
</div>
    <div id="content">
<div class="markdown-body" id="postBody"><p>本教程由作者<strong>xhx</strong> 与 <strong>Claud 3.7 Sonnet</strong>  共同创作完成。</p>
<p>本系统基于<strong>CentOS7 2009</strong> 版，其他版本系统可能存在各种问题，请不要轻易尝试，以免无谓浪费时间。适用于虚拟机环境或者物理机环境。推荐在<strong>VirtualBox</strong> 中安装虚拟机来完成。终端工具建议使用<strong>MobarXterm</strong>，文件传输工具使用<strong>WinSCP</strong>。</p>
<p>本指南共分为11个部分，主要安装的大数据开发组件包括：</p>
<ul>
<li>
<p>MySQL 5.7</p>
</li>
<li>
<p>JDK 1.8</p>
</li>
<li>
<p>Hadoop 3.1.3</p>
</li>
<li>
<p>ZooKeeper 3.5.7</p>
</li>
<li>
<p>Hive 3.1.2</p>
</li>
<li>
<p>Kafka 2.4.1</p>
</li>
<li>
<p>Saprk 3.1.1</p>
</li>
<li>
<p>Flink 1.14.0</p>
</li>
<li>
<p>HBase 2.2.3</p>
</li>
<li>
<p>Flume 1.9.0</p>
</li>
</ul>
<p>本指南所需要的软件下载链接为：<a href="https://pan.quark.cn/s/49707c42257e" rel="nofollow">https://pan.quark.cn/s/49707c42257e</a></p>
<p>基本上和大数据职业院校技能大赛江苏省省赛所要求的环境一致。大数据的开发环境对版本的依赖性较高，没有必要追求新版的组件，以避免出现各种莫名其妙的BUG。</p>
<h2>0. 准备工作</h2>
<p>首先，我们需要设置一些基本环境变量和目录结构。</p>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 创建应用程序安装目录</span>
mkdir -p /opt/module
mkdir -p /opt/software


<span class="pl-c"><span class="pl-c">#</span> 创建数据目录</span>
mkdir -p /data


<span class="pl-c"><span class="pl-c">#</span> 设置JAVA_HOME环境变量</span>
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>export JAVA_HOME=/opt/module/jdk1.8.0<span class="pl-pds">'</span></span> <span class="pl-k">&gt;&gt;</span> /etc/profile
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>export PATH=$PATH:$JAVA_HOME/bin<span class="pl-pds">'</span></span> <span class="pl-k">&gt;&gt;</span> /etc/profile


<span class="pl-c"><span class="pl-c">#</span> 设置主机名和hosts</span>
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span>master<span class="pl-pds">"</span></span> <span class="pl-k">&gt;</span> /etc/hostname
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span>127.0.0.1 master<span class="pl-pds">"</span></span> <span class="pl-k">&gt;&gt;</span> /etc/hosts


<span class="pl-c"><span class="pl-c">#</span> 刷新环境变量</span>
<span class="pl-c1">source</span> /etc/profile</pre></div>
<h2>1. 安装MySQL5.7</h2>
<p>需要的离线安装包如下：</p>
<div class="highlight highlight-source-scala"><pre class="notranslate">mysql<span class="pl-k">-</span>community<span class="pl-k">-</span>common<span class="pl-k">-</span><span class="pl-c1">5.7.28</span><span class="pl-k">-</span><span class="pl-c1">1</span>.el7.x86_64.rpm
mysql<span class="pl-k">-</span>community<span class="pl-k">-</span>libs<span class="pl-k">-</span><span class="pl-c1">5.7.28</span><span class="pl-k">-</span><span class="pl-c1">1</span>.el7.x86_64.rpm
mysql<span class="pl-k">-</span>community<span class="pl-k">-</span>client<span class="pl-k">-</span><span class="pl-c1">5.7.28</span><span class="pl-k">-</span><span class="pl-c1">1</span>.el7.x86_64.rpm
mysql<span class="pl-k">-</span>community<span class="pl-k">-</span>server<span class="pl-k">-</span><span class="pl-c1">5.7.28</span><span class="pl-k">-</span><span class="pl-c1">1</span>.el7.x86_64.rpm</pre></div>
<p>将所需要的安装包放在一个文件夹下面，比如  <code class="notranslate">mysqlhome</code> 。为了避免逐一下载依赖，可以使用下面的命令</p>
<div class="highlight highlight-source-scala"><pre class="notranslate">yum localinstall <span class="pl-k">*</span>.rpm <span class="pl-k">-</span>y</pre></div>
<p>在联网的情况下自动下载相关依赖文件。</p>
<p>安装完成之后启动mysql服务</p>
<div class="highlight highlight-source-scala"><pre class="notranslate"><span class="pl-k">#</span> 启动 <span class="pl-en">MySQL</span> 服务
systemctl start mysqld
systemctl enable mysqld</pre></div>
<p>下面将root密码修改为“123456”。</p>
<ul>
<li>获取临时密码</li>
</ul>
<div class="highlight highlight-source-scala"><pre class="notranslate"><span class="pl-k">#</span> 获取临时 root 密码
sudo grep <span class="pl-k">'</span><span class="pl-c1">temporary</span> password<span class="pl-s">'<span class="pl-ii"> /var/log/mysqld.log</span></span>


<span class="pl-k">#</span> 登录 <span class="pl-en">MySQL</span>
mysql <span class="pl-k">-</span>uroot <span class="pl-k">-</span>p</pre></div>
<ul>
<li>修改密码策略：</li>
</ul>
<div class="highlight highlight-source-scala"><pre class="notranslate"><span class="pl-k">#</span> 编辑 <span class="pl-en">MySQL</span> 配置文件
vi <span class="pl-k">/</span>etc<span class="pl-k">/</span>my.cnf


<span class="pl-k">#</span> 添加以下内容到 [mysqld] 部分
[mysqld]
validate_password_policy<span class="pl-k">=</span><span class="pl-en">LOW</span>
validate_password_length<span class="pl-k">=</span><span class="pl-c1">6</span>
validate_password_special_char_count<span class="pl-k">=</span><span class="pl-c1">0</span>
validate_password_mixed_case_count<span class="pl-k">=</span><span class="pl-c1">0</span>
validate_password_number_count<span class="pl-k">=</span><span class="pl-c1">0</span></pre></div>
<p>重新启动mysqld服务</p>
<div class="highlight highlight-source-scala"><pre class="notranslate">systemctl restart mysqld</pre></div>
<ul>
<li>登录后修改 root 密码：（比如修改为123456，不可用于生产环境）</li>
</ul>
<div class="highlight highlight-source-scala"><pre class="notranslate"><span class="pl-en">ALTER</span> <span class="pl-en">USER</span> <span class="pl-s">'<span class="pl-ii">root</span>'</span><span class="pl-k">@</span><span class="pl-s">'<span class="pl-ii">localhost</span>'</span> <span class="pl-en">IDENTIFIED</span> <span class="pl-en">BY</span> <span class="pl-s">'<span class="pl-ii">123456</span>'</span>;</pre></div>
<p>开启远程访问</p>
<ul>
<li>授予 root 用户从任何主机访问的权限</li>
</ul>
<div class="highlight highlight-source-scala"><pre class="notranslate"><span class="pl-en">CREATE</span> <span class="pl-en">USER</span> <span class="pl-s">'<span class="pl-ii">root</span>'</span><span class="pl-k">@</span><span class="pl-s">'%'</span> <span class="pl-en">IDENTIFIED</span> <span class="pl-en">BY</span> <span class="pl-s">'<span class="pl-ii">123456</span>'</span>;
<span class="pl-en">GRANT</span> <span class="pl-en">ALL</span> <span class="pl-en">PRIVILEGES</span> <span class="pl-en">ON</span> <span class="pl-k">*</span>.<span class="pl-k">*</span> <span class="pl-en">TO</span> <span class="pl-s">'<span class="pl-ii">root</span>'</span><span class="pl-k">@</span><span class="pl-s">'%'</span> <span class="pl-en">WITH</span> <span class="pl-en">GRANT</span> <span class="pl-en">OPTION</span>;
<span class="pl-en">FLUSH</span> <span class="pl-en">PRIVILEGES</span>;</pre></div>
<ul>
<li>关闭centos7 防火墙</li>
</ul>
<div class="highlight highlight-source-scala"><pre class="notranslate">systemctl stop firewalld
systemctl disable firewalld</pre></div>
<ul>
<li>测试，使用navicat连接测试</li>
</ul>
<h2>2. 安装JDK 1.8</h2>
<div class="highlight highlight-source-scala"><pre class="notranslate">cd <span class="pl-k">/</span>opt<span class="pl-k">/</span>software


<span class="pl-k">#</span> 解压<span class="pl-en">JDK</span>
tar <span class="pl-k">-</span>zxvf jdk<span class="pl-k">-</span>8u<span class="pl-k">*</span>.tar.gz <span class="pl-k">-</span><span class="pl-en">C</span> <span class="pl-k">/</span>opt<span class="pl-k">/</span>module<span class="pl-k">/</span>
mv <span class="pl-k">/</span>opt<span class="pl-k">/</span>module<span class="pl-k">/</span>jdk1<span class="pl-c1">.8.0_</span>* <span class="pl-k">/</span>opt<span class="pl-k">/</span>module<span class="pl-k">/</span>jdk1<span class="pl-c1">.8.0</span>


<span class="pl-k">#</span> 验证安装
source <span class="pl-k">/</span>etc<span class="pl-k">/</span>profile
java <span class="pl-k">-</span>version</pre></div>
<h2>3. 安装Hadoop 3.1.3和Yarn 3.1.3</h2>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 解压Hadoop</span>
tar -zxvf hadoop-3.1.3.tar.gz -C /opt/module/


<span class="pl-c"><span class="pl-c">#</span> 配置环境变量</span>
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>export HADOOP_HOME=/opt/module/hadoop-3.1.3<span class="pl-pds">'</span></span> <span class="pl-k">&gt;&gt;</span> /etc/profile
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>export PATH=$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin<span class="pl-pds">'</span></span> <span class="pl-k">&gt;&gt;</span> /etc/profile
<span class="pl-c1">source</span> /etc/profile


<span class="pl-c"><span class="pl-c">#</span> 配置core-site.xml</span>
cat <span class="pl-k">&gt;</span> /opt/module/hadoop-3.1.3/etc/hadoop/core-site.xml <span class="pl-s"><span class="pl-k">&lt;&lt;</span> <span class="pl-k">EOF</span></span>
<span class="pl-s">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="pl-s">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span>
<span class="pl-s">&lt;configuration&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;fs.defaultFS&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;hdfs://master:9000&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;/data/hadoop/tmp&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">&lt;/configuration&gt;</span>
<span class="pl-s"><span class="pl-k">EOF</span></span>


<span class="pl-c"><span class="pl-c">#</span> 配置hdfs-site.xml</span>
mkdir -p /data/hadoop/hdfs/{name,data}
cat <span class="pl-k">&gt;</span> /opt/module/hadoop-3.1.3/etc/hadoop/hdfs-site.xml <span class="pl-s"><span class="pl-k">&lt;&lt;</span> <span class="pl-k">EOF</span></span>
<span class="pl-s">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="pl-s">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span>
<span class="pl-s">&lt;configuration&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">      &lt;name&gt;dfs.namenode.rpc-bind-host&lt;/name&gt;</span>
<span class="pl-s">      &lt;value&gt;0.0.0.0&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;dfs.replication&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;1&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;dfs.namenode.name.dir&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;/data/hadoop/hdfs/name&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;dfs.datanode.data.dir&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;/data/hadoop/hdfs/data&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">&lt;/configuration&gt;</span>
<span class="pl-s"><span class="pl-k">EOF</span></span>


<span class="pl-c"><span class="pl-c">#</span> 配置mapred-site.xml</span>
cat <span class="pl-k">&gt;</span> /opt/module/hadoop-3.1.3/etc/hadoop/mapred-site.xml <span class="pl-s"><span class="pl-k">&lt;&lt;</span> <span class="pl-k">EOF</span></span>
<span class="pl-s">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="pl-s">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span>
<span class="pl-s">&lt;configuration&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;mapreduce.framework.name&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;yarn&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;mapreduce.jobhistory.address&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;master:10020&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;mapreduce.jobhistory.webapp.address&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;master:19888&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">&lt;/configuration&gt;</span>
<span class="pl-s"><span class="pl-k">EOF</span></span>


<span class="pl-c"><span class="pl-c">#</span> 配置yarn-site.xml</span>
cat <span class="pl-k">&gt;</span> /opt/module/hadoop-3.1.3/etc/hadoop/yarn-site.xml <span class="pl-s"><span class="pl-k">&lt;&lt;</span> <span class="pl-k">EOF</span></span>
<span class="pl-s">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="pl-s">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span>
<span class="pl-s">&lt;configuration&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;mapreduce_shuffle&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;master&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;yarn.nodemanager.env-whitelist&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">&lt;/configuration&gt;</span>
<span class="pl-s"><span class="pl-k">EOF</span></span>


<span class="pl-c"><span class="pl-c">#</span> 格式化HDFS</span>
hdfs namenode -format


<span class="pl-c"><span class="pl-c">#</span> 编辑 start-dfs.sh 和 stop-dfs.sh</span>
vi /opt/module/hadoop-3.1.3/sbin/start-dfs.sh


<span class="pl-c"><span class="pl-c">#</span> 在文件开头添加以下内容（#!/bin/bash 行之后）</span>
<span class="pl-k">export</span> HDFS_NAMENODE_USER=root
<span class="pl-k">export</span> HDFS_DATANODE_USER=root
<span class="pl-k">export</span> HDFS_SECONDARYNAMENODE_USER=root
<span class="pl-k">export</span> YARN_RESOURCEMANAGER_USER=root
<span class="pl-k">export</span> YARN_NODEMANAGER_USER=root


<span class="pl-c"><span class="pl-c">#</span> 同样，编辑 /opt/module/hadoop-3.1.3/sbin/start-yarn.sh 和 /opt/module/hadoop-3.1.3/sbin/stop-yarn.sh 文件：</span>




<span class="pl-c"><span class="pl-c">#</span> 编辑 start-yarn.sh</span>
vi /opt/module/hadoop-3.1.3/sbin/start-yarn.sh


<span class="pl-c"><span class="pl-c">#</span> 在文件开头添加以下内容（#!/bin/bash 行之后）</span>
<span class="pl-k">export</span> YARN_RESOURCEMANAGER_USER=root
<span class="pl-k">export</span> YARN_NODEMANAGER_USER=root


<span class="pl-c"><span class="pl-c">#</span> 免密</span>
ssh-keygen
ssh-copy-id master
<span class="pl-c"><span class="pl-c">#</span> 修改hadoop-env.sh</span>
vi /opt/module/hadoop-3.1.3/etc/hadoop/hadoop-env.sh
<span class="pl-k">export</span> JAVA_HOME=/opt/module/jdk1.8.0
<span class="pl-c"><span class="pl-c">#</span> 启动Hadoop</span>
/opt/module/hadoop-3.1.3/sbin/start-dfs.sh
/opt/module/hadoop-3.1.3/sbin/start-yarn.sh</pre></div>
<h2>4. 安装ZooKeeper 3.5.7</h2>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 解压ZooKeeper</span>
tar -zxvf apache-zookeeper-3.5.7-bin.tar.gz -C /opt/module/
mv /opt/module/apache-zookeeper-3.5.7-bin /opt/module/zookeeper-3.5.7


<span class="pl-c"><span class="pl-c">#</span> 配置环境变量</span>
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>export ZOOKEEPER_HOME=/opt/module/zookeeper-3.5.7<span class="pl-pds">'</span></span> <span class="pl-k">&gt;&gt;</span> /etc/profile
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>export PATH=$PATH:$ZOOKEEPER_HOME/bin<span class="pl-pds">'</span></span> <span class="pl-k">&gt;&gt;</span> /etc/profile
<span class="pl-c1">source</span> /etc/profile


<span class="pl-c"><span class="pl-c">#</span> 创建数据目录</span>
mkdir -p /data/zookeeper


<span class="pl-c"><span class="pl-c">#</span> 配置zoo.cfg</span>
cat <span class="pl-k">&gt;</span> /opt/module/zookeeper-3.5.7/conf/zoo.cfg <span class="pl-s"><span class="pl-k">&lt;&lt;</span> <span class="pl-k">EOF</span></span>
<span class="pl-s">tickTime=2000</span>
<span class="pl-s">initLimit=10</span>
<span class="pl-s">syncLimit=5</span>
<span class="pl-s">dataDir=/data/zookeeper</span>
<span class="pl-s">clientPort=2181</span>
<span class="pl-s">server.1=master:2888:3888</span>
<span class="pl-s"><span class="pl-k">EOF</span></span>


<span class="pl-c"><span class="pl-c">#</span> 创建myid文件</span>
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span>1<span class="pl-pds">"</span></span> <span class="pl-k">&gt;</span> /data/zookeeper/myid


<span class="pl-c"><span class="pl-c">#</span> 启动ZooKeeper</span>
/opt/module/zookeeper-3.5.7/bin/zkServer.sh start</pre></div>
<h2>5. 安装Hive 3.1.2</h2>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 解压Hive</span>
tar -zxvf apache-hive-3.1.2-bin.tar.gz -C /opt/module/
mv /opt/module/apache-hive-3.1.2-bin /opt/module/hive-3.1.2


<span class="pl-c"><span class="pl-c">#</span> 配置环境变量</span>
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>export HIVE_HOME=/opt/module/hive-3.1.2<span class="pl-pds">'</span></span> <span class="pl-k">&gt;&gt;</span> /etc/profile
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>export PATH=$PATH:$HIVE_HOME/bin<span class="pl-pds">'</span></span> <span class="pl-k">&gt;&gt;</span> /etc/profile
<span class="pl-c1">source</span> /etc/profile


<span class="pl-c"><span class="pl-c">#</span> 创建Hive的HDFS目录</span>
hadoop fs -mkdir -p /user/hive/warehouse
hadoop fs -mkdir -p /tmp/hive
hadoop fs -chmod g+w /user/hive/warehouse
hadoop fs -chmod g+w /tmp/hive


<span class="pl-c"><span class="pl-c">#</span> 配置hive-site.xml</span>
cat <span class="pl-k">&gt;</span> /opt/module/hive-3.1.2/conf/hive-site.xml <span class="pl-s"><span class="pl-k">&lt;&lt;</span> <span class="pl-k">EOF</span></span>
<span class="pl-s">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span>
<span class="pl-s">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span>
<span class="pl-s">&lt;configuration&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;jdbc:mysql://localhost:3306/metastore?createDatabaseIfNotExist=true&amp;amp;useSSL=false&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;root&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;123456&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;hive.metastore.warehouse.dir&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;/user/hive/warehouse&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;hive.metastore.schema.verification&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;false&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;hive.server2.thrift.bind.host&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;master&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;hive.metastore.event.db.notification.api.auth&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;false&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">&lt;/configuration&gt;</span>
<span class="pl-s"><span class="pl-k">EOF</span></span>


<span class="pl-c"><span class="pl-c">#</span> 复制MySQL JDBC驱动到Hive的lib目录</span>
cp mysql-connector-j-8.4.0.jar /opt/module/hive-3.1.2/lib/


<span class="pl-c"><span class="pl-c">#</span> Guava版本冲突确认</span>
<span class="pl-c"><span class="pl-c">#</span> 查看 Hadoop 使用的 Guava 版本</span>
find <span class="pl-smi">$HADOOP_HOME</span> -name <span class="pl-s"><span class="pl-pds">"</span>guava*.jar<span class="pl-pds">"</span></span>


<span class="pl-c"><span class="pl-c">#</span> 查看 Hive 使用的 Guava 版本</span>
find <span class="pl-smi">$HIVE_HOME</span> -name <span class="pl-s"><span class="pl-pds">"</span>guava*.jar<span class="pl-pds">"</span></span>


<span class="pl-c"><span class="pl-c">#</span> 删除 Hive 的 Guava JAR</span>
find <span class="pl-smi">$HIVE_HOME</span>/lib -name <span class="pl-s"><span class="pl-pds">"</span>guava*.jar<span class="pl-pds">"</span></span> -exec rm -f {} <span class="pl-cce">\;</span>


<span class="pl-c"><span class="pl-c">#</span> 复制 Hadoop 的 Guava JAR 到 Hive lib 目录</span>
find <span class="pl-smi">$HADOOP_HOME</span> -name <span class="pl-s"><span class="pl-pds">"</span>guava*.jar<span class="pl-pds">"</span></span> -exec cp {} <span class="pl-smi">$HIVE_HOME</span>/lib/ <span class="pl-cce">\;</span>


<span class="pl-c"><span class="pl-c">#</span> 初始化Hive元数据库</span>
/opt/module/hive-3.1.2/bin/schematool -dbType mysql -initSchema


<span class="pl-c"><span class="pl-c">#</span> 创建目录</span>
hadoop fs -mkdir -p /tmp/hive
hadoop fs -chmod -R 777 /tmp/hive


<span class="pl-c"><span class="pl-c">#</span> 启动Hive Metastore服务</span>
nohup hive --service metastore <span class="pl-k">&amp;</span>
<span class="pl-c"><span class="pl-c">#</span> 启动HiveServer2</span>
nohup hive --service hiveserver2  <span class="pl-k">&amp;</span></pre></div>
<h2>6. 安装Kafka 2.4.1</h2>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 解压Kafka</span>
tar -zxvf kafka_2.12-2.4.1.tgz -C /opt/module/
mv /opt/module/kafka_2.12-2.4.1 /opt/module/kafka-2.4.1


<span class="pl-c"><span class="pl-c">#</span> 配置环境变量</span>
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>export KAFKA_HOME=/opt/module/kafka-2.4.1<span class="pl-pds">'</span></span> <span class="pl-k">&gt;&gt;</span> /etc/profile
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>export PATH=$PATH:$KAFKA_HOME/bin<span class="pl-pds">'</span></span> <span class="pl-k">&gt;&gt;</span> /etc/profile
<span class="pl-c1">source</span> /etc/profile


<span class="pl-c"><span class="pl-c">#</span> 创建Kafka日志目录</span>
mkdir -p /data/kafka-logs


<span class="pl-c"><span class="pl-c">#</span> 修改Kafka配置</span>
cat <span class="pl-k">&gt;</span> /opt/module/kafka-2.4.1/config/server.properties <span class="pl-s"><span class="pl-k">&lt;&lt;</span> <span class="pl-k">EOF</span></span>
<span class="pl-s">broker.id=0</span>
<span class="pl-s">listeners=PLAINTEXT://master:9092</span>
<span class="pl-s">num.network.threads=3</span>
<span class="pl-s">num.io.threads=8</span>
<span class="pl-s">socket.send.buffer.bytes=102400</span>
<span class="pl-s">socket.receive.buffer.bytes=102400</span>
<span class="pl-s">socket.request.max.bytes=104857600</span>
<span class="pl-s">log.dirs=/data/kafka-logs</span>
<span class="pl-s">num.partitions=1</span>
<span class="pl-s">num.recovery.threads.per.data.dir=1</span>
<span class="pl-s">offsets.topic.replication.factor=1</span>
<span class="pl-s">transaction.state.log.replication.factor=1</span>
<span class="pl-s">transaction.state.log.min.isr=1</span>
<span class="pl-s">log.retention.hours=168</span>
<span class="pl-s">log.segment.bytes=1073741824</span>
<span class="pl-s">log.retention.check.interval.ms=300000</span>
<span class="pl-s">zookeeper.connect=master:2181</span>
<span class="pl-s">zookeeper.connection.timeout.ms=18000</span>
<span class="pl-s">group.initial.rebalance.delay.ms=0</span>
<span class="pl-s"><span class="pl-k">EOF</span></span>


<span class="pl-c"><span class="pl-c">#</span> 启动Kafka</span>
nohup /opt/module/kafka-2.4.1/bin/kafka-server-start.sh /opt/module/kafka-2.4.1/config/server.properties <span class="pl-k">&amp;</span></pre></div>
<h2>7. 安装Spark 3.1.1</h2>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 解压Spark</span>
tar -zxvf spark-3.1.1-bin-hadoop3.2.tgz -C /opt/module/
mv /opt/module/spark-3.1.1-bin-hadoop3.2 /opt/module/spark-3.1.1


<span class="pl-c"><span class="pl-c">#</span> 配置环境变量</span>
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>export SPARK_HOME=/opt/module/spark-3.1.1<span class="pl-pds">'</span></span> <span class="pl-k">&gt;&gt;</span> /etc/profile
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>export PATH=$PATH:$SPARK_HOME/bin<span class="pl-pds">'</span></span> <span class="pl-k">&gt;&gt;</span> /etc/profile
<span class="pl-c1">source</span> /etc/profile


<span class="pl-c"><span class="pl-c">#</span> 配置spark-env.sh</span>
cp /opt/module/spark-3.1.1/conf/spark-env.sh.template /opt/module/spark-3.1.1/conf/spark-env.sh
cat <span class="pl-k">&gt;&gt;</span> /opt/module/spark-3.1.1/conf/spark-env.sh <span class="pl-s"><span class="pl-k">&lt;&lt;</span> <span class="pl-k">EOF</span></span>
<span class="pl-s">export JAVA_HOME=/opt/module/jdk1.8.0</span>
<span class="pl-s">export HADOOP_HOME=/opt/module/hadoop-3.1.3</span>
<span class="pl-s">export HADOOP_CONF_DIR=/opt/module/hadoop-3.1.3/etc/hadoop</span>
<span class="pl-s">export SPARK_MASTER_HOST=master</span>
<span class="pl-s">export SPARK_MASTER_PORT=7077</span>
<span class="pl-s">export SPARK_WORKER_CORES=1</span>
<span class="pl-s">export SPARK_WORKER_MEMORY=1g</span>
<span class="pl-s"><span class="pl-k">EOF</span></span>


<span class="pl-c"><span class="pl-c">#</span> 配置spark-defaults.conf</span>
cp /opt/module/spark-3.1.1/conf/spark-defaults.conf.template /opt/module/spark-3.1.1/conf/spark-defaults.conf
cat <span class="pl-k">&gt;&gt;</span> /opt/module/spark-3.1.1/conf/spark-defaults.conf <span class="pl-s"><span class="pl-k">&lt;&lt;</span> <span class="pl-k">EOF</span></span>
<span class="pl-s">spark.master                     spark://master:7077</span>
<span class="pl-s">spark.eventLog.enabled           true</span>
<span class="pl-s">spark.eventLog.dir               hdfs://master:9000/spark-logs</span>
<span class="pl-s">spark.history.fs.logDirectory    hdfs://master:9000/spark-logs</span>
<span class="pl-s"><span class="pl-k">EOF</span></span>


<span class="pl-c"><span class="pl-c">#</span> 创建Spark历史服务器日志目录</span>
hadoop fs -mkdir -p /spark-logs


<span class="pl-c"><span class="pl-c">#</span> 启动Spark</span>
/opt/module/spark-3.1.1/sbin/start-all.sh
/opt/module/spark-3.1.1/sbin/start-history-server.sh</pre></div>
<h2>8. 安装Flink 1.14.0</h2>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 解压Flink</span>
tar -zxvf flink-1.14.0-bin-scala_2.12.tgz -C /opt/module/
mv /opt/module/flink-1.14.0 /opt/module/flink-1.14.0


<span class="pl-c"><span class="pl-c">#</span> 配置环境变量</span>
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>export FLINK_HOME=/opt/module/flink-1.14.0<span class="pl-pds">'</span></span> <span class="pl-k">&gt;&gt;</span> /etc/profile
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>export PATH=$PATH:$FLINK_HOME/bin<span class="pl-pds">'</span></span> <span class="pl-k">&gt;&gt;</span> /etc/profile
<span class="pl-c1">source</span> /etc/profile


<span class="pl-c"><span class="pl-c">#</span> 配置flink-conf.yaml</span>
cat <span class="pl-k">&gt;</span> /opt/module/flink-1.14.0/conf/flink-conf.yaml <span class="pl-s"><span class="pl-k">&lt;&lt;</span> <span class="pl-k">EOF</span></span>
<span class="pl-s">jobmanager.rpc.address: master</span>
<span class="pl-s">jobmanager.rpc.port: 6123</span>
<span class="pl-s">jobmanager.memory.process.size: 1600m</span>
<span class="pl-s">taskmanager.memory.process.size: 1728m</span>
<span class="pl-s">taskmanager.numberOfTaskSlots: 1</span>
<span class="pl-s">parallelism.default: 1</span>
<span class="pl-s"><span class="pl-k">EOF</span></span>


<span class="pl-c"><span class="pl-c">#</span> 配置workers</span>
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span>master<span class="pl-pds">"</span></span> <span class="pl-k">&gt;</span> /opt/module/flink-1.14.0/conf/workers


<span class="pl-c"><span class="pl-c">#</span> 启动Flink</span>
/opt/module/flink-1.14.0/bin/start-cluster.sh</pre></div>
<h2>9. 安装HBase 2.2.3</h2>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 解压HBase</span>
tar -zxvf hbase-2.2.3-bin.tar.gz -C /opt/module/
mv /opt/module/hbase-2.2.3 /opt/module/hbase-2.2.3


<span class="pl-c"><span class="pl-c">#</span> 配置环境变量</span>
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>export HBASE_HOME=/opt/module/hbase-2.2.3<span class="pl-pds">'</span></span> <span class="pl-k">&gt;&gt;</span> /etc/profile
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>export PATH=$PATH:$HBASE_HOME/bin<span class="pl-pds">'</span></span> <span class="pl-k">&gt;&gt;</span> /etc/profile
<span class="pl-c1">source</span> /etc/profile


<span class="pl-c"><span class="pl-c">#</span> 配置hbase-env.sh</span>
cat <span class="pl-k">&gt;&gt;</span> /opt/module/hbase-2.2.3/conf/hbase-env.sh <span class="pl-s"><span class="pl-k">&lt;&lt;</span> <span class="pl-k">EOF</span></span>
<span class="pl-s">export JAVA_HOME=/opt/module/jdk1.8.0</span>
<span class="pl-s">export HBASE_MANAGES_ZK=false</span>
<span class="pl-s"><span class="pl-k">EOF</span></span>


<span class="pl-c"><span class="pl-c">#</span> 配置hbase-site.xml</span>
cat <span class="pl-k">&gt;</span> /opt/module/hbase-2.2.3/conf/hbase-site.xml <span class="pl-s"><span class="pl-k">&lt;&lt;</span> <span class="pl-k">EOF</span></span>
<span class="pl-s">&lt;?xml version="1.0"?&gt;</span>
<span class="pl-s">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span>
<span class="pl-s">&lt;configuration&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;hbase.rootdir&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;hdfs://master:9000/hbase&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;hbase.cluster.distributed&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;true&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;master&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;hbase.zookeeper.property.clientPort&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;2181&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">    &lt;property&gt;</span>
<span class="pl-s">        &lt;name&gt;hbase.unsafe.stream.capability.enforce&lt;/name&gt;</span>
<span class="pl-s">        &lt;value&gt;false&lt;/value&gt;</span>
<span class="pl-s">    &lt;/property&gt;</span>
<span class="pl-s">&lt;/configuration&gt;</span>
<span class="pl-s"><span class="pl-k">EOF</span></span>


<span class="pl-c"><span class="pl-c">#</span> 启动HBase</span>
/opt/module/hbase-2.2.3/bin/start-hbase.sh</pre></div>
<h2>10. 安装Flume 1.9.0</h2>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 解压Flume</span>
tar -zxvf apache-flume-1.9.0-bin.tar.gz -C /opt/module/
mv /opt/module/apache-flume-1.9.0-bin /opt/module/flume-1.9.0


<span class="pl-c"><span class="pl-c">#</span> 配置环境变量</span>
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>export FLUME_HOME=/opt/module/flume-1.9.0<span class="pl-pds">'</span></span> <span class="pl-k">&gt;&gt;</span> /etc/profile
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>export PATH=$PATH:$FLUME_HOME/bin<span class="pl-pds">'</span></span> <span class="pl-k">&gt;&gt;</span> /etc/profile
<span class="pl-c1">source</span> /etc/profile


<span class="pl-c"><span class="pl-c">#</span> 配置flume-env.sh</span>
cp /opt/module/flume-1.9.0/conf/flume-env.sh.template /opt/module/flume-1.9.0/conf/flume-env.sh
cat <span class="pl-k">&gt;&gt;</span> /opt/module/flume-1.9.0/conf/flume-env.sh <span class="pl-s"><span class="pl-k">&lt;&lt;</span> <span class="pl-k">EOF</span></span>
<span class="pl-s">export JAVA_HOME=/opt/module/jdk1.8.0</span>
<span class="pl-s"><span class="pl-k">EOF</span></span>


<span class="pl-c"><span class="pl-c">#</span> 创建一个简单的Flume配置示例</span>
cat <span class="pl-k">&gt;</span> /opt/module/flume-1.9.0/conf/example.conf <span class="pl-s"><span class="pl-k">&lt;&lt;</span> <span class="pl-k">EOF</span></span>
<span class="pl-s"># example.conf: A single-node Flume configuration</span>
<span class="pl-s"></span>
<span class="pl-s"></span>
<span class="pl-s"># Name the components on this agent</span>
<span class="pl-s">a1.sources = r1</span>
<span class="pl-s">a1.sinks = k1</span>
<span class="pl-s">a1.channels = c1</span>
<span class="pl-s"></span>
<span class="pl-s"></span>
<span class="pl-s"># Describe/configure the source</span>
<span class="pl-s">a1.sources.r1.type = netcat</span>
<span class="pl-s">a1.sources.r1.bind = master</span>
<span class="pl-s">a1.sources.r1.port = 44444</span>
<span class="pl-s"></span>
<span class="pl-s"></span>
<span class="pl-s"># Describe the sink</span>
<span class="pl-s">a1.sinks.k1.type = logger</span>
<span class="pl-s"></span>
<span class="pl-s"></span>
<span class="pl-s"># Use a channel which buffers events in memory</span>
<span class="pl-s">a1.channels.c1.type = memory</span>
<span class="pl-s">a1.channels.c1.capacity = 1000</span>
<span class="pl-s">a1.channels.c1.transactionCapacity = 100</span>
<span class="pl-s"></span>
<span class="pl-s"></span>
<span class="pl-s"># Bind the source and sink to the channel</span>
<span class="pl-s">a1.sources.r1.channels = c1</span>
<span class="pl-s">a1.sinks.k1.channel = c1</span>
<span class="pl-s"><span class="pl-k">EOF</span></span></pre></div>
<h2>11. 启动脚本</h2>
<p>下面是启动核心组件的脚本（不包含Hbase，可能存在冲突）</p>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#!</span>/bin/bash</span>

<span class="pl-c"><span class="pl-c">#</span> 大数据组件启动/关闭脚本</span>
<span class="pl-c"><span class="pl-c">#</span> 用法: ./bigdata_control.sh [start|stop|status]</span>
<span class="pl-c"><span class="pl-c">#</span> 组件顺序:</span>
<span class="pl-c"><span class="pl-c">#</span> 启动: HDFS -&gt; YARN -&gt; ZooKeeper -&gt; Hive -&gt; Kafka -&gt; Flink</span>
<span class="pl-c"><span class="pl-c">#</span> 关闭: Flink -&gt; Kafka -&gt; Hive -&gt; ZooKeeper -&gt; YARN -&gt; HDFS</span>


<span class="pl-c"><span class="pl-c">#</span> 颜色定义</span>
GREEN=<span class="pl-s"><span class="pl-pds">'</span>\033[0;32m<span class="pl-pds">'</span></span>
RED=<span class="pl-s"><span class="pl-pds">'</span>\033[0;31m<span class="pl-pds">'</span></span>
YELLOW=<span class="pl-s"><span class="pl-pds">'</span>\033[0;33m<span class="pl-pds">'</span></span>
BLUE=<span class="pl-s"><span class="pl-pds">'</span>\033[0;34m<span class="pl-pds">'</span></span>
NC=<span class="pl-s"><span class="pl-pds">'</span>\033[0m<span class="pl-pds">'</span></span> <span class="pl-c"><span class="pl-c">#</span> No Color</span>


<span class="pl-c"><span class="pl-c">#</span> 日志文件</span>
LOG_DIR=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$HOME</span>/logs<span class="pl-pds">"</span></span>
mkdir -p <span class="pl-smi">$LOG_DIR</span>
LOG_FILE=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$LOG_DIR</span>/bigdata_control_<span class="pl-s"><span class="pl-pds">$(</span>date <span class="pl-s"><span class="pl-pds">'</span>+%Y%m%d<span class="pl-pds">'</span></span><span class="pl-pds">)</span></span>.log<span class="pl-pds">"</span></span>


<span class="pl-c"><span class="pl-c">#</span> 检查命令行参数</span>
<span class="pl-k">if</span> [ <span class="pl-smi">$#</span> <span class="pl-k">-ne</span> 1 ] <span class="pl-k">||</span> [[ <span class="pl-k">!</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$1</span><span class="pl-pds">"</span></span> <span class="pl-k">=~</span> ^(start<span class="pl-k">|</span>stop<span class="pl-k">|</span>status)$ ]]<span class="pl-k">;</span> <span class="pl-k">then</span>
    <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${RED}</span>用法错误: <span class="pl-smi">$0</span> [start|stop|status]<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    <span class="pl-c1">exit</span> 1
<span class="pl-k">fi</span>


ACTION=<span class="pl-smi">$1</span>


<span class="pl-c"><span class="pl-c">#</span> 记录操作开始</span>
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-s"><span class="pl-pds">$(</span>date <span class="pl-s"><span class="pl-pds">'</span>+%Y-%m-%d %H:%M:%S<span class="pl-pds">'</span></span><span class="pl-pds">)</span></span> - 开始执行 <span class="pl-smi">$ACTION</span> 操作<span class="pl-pds">"</span></span> <span class="pl-k">&gt;&gt;</span> <span class="pl-smi">$LOG_FILE</span>


<span class="pl-c"><span class="pl-c">#</span> 检查 Hive Metastore 进程</span>
<span class="pl-en">check_hive_metastore</span>() {
    <span class="pl-k">if</span> ps aux <span class="pl-k">|</span> grep -v grep <span class="pl-k">|</span> grep <span class="pl-s"><span class="pl-pds">"</span>org.apache.hadoop.hive.metastore.HiveMetaStore<span class="pl-pds">"</span></span> <span class="pl-k">&gt;</span> /dev/null<span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-k">return</span> 0
    <span class="pl-k">fi</span>
    
    <span class="pl-k">if</span> ps aux <span class="pl-k">|</span> grep -v grep <span class="pl-k">|</span> grep <span class="pl-s"><span class="pl-pds">"</span>\-\-service metastore<span class="pl-pds">"</span></span> <span class="pl-k">&gt;</span> /dev/null<span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-k">return</span> 0
    <span class="pl-k">fi</span>
    
    <span class="pl-k">if</span> netstat -tlnp <span class="pl-k">2&gt;</span>/dev/null <span class="pl-k">|</span> grep -q <span class="pl-s"><span class="pl-pds">"</span>:9083<span class="pl-pds">"</span></span><span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-k">return</span> 0
    <span class="pl-k">fi</span>
    
    <span class="pl-k">return</span> 1
}


<span class="pl-c"><span class="pl-c">#</span> 检查 HiveServer2 进程</span>
<span class="pl-en">check_hiveserver2</span>() {
    <span class="pl-k">if</span> ps aux <span class="pl-k">|</span> grep -v grep <span class="pl-k">|</span> grep <span class="pl-s"><span class="pl-pds">"</span>org.apache.hive.service.server.HiveServer2<span class="pl-pds">"</span></span> <span class="pl-k">&gt;</span> /dev/null<span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-k">return</span> 0
    <span class="pl-k">fi</span>
    
    <span class="pl-k">if</span> ps aux <span class="pl-k">|</span> grep -v grep <span class="pl-k">|</span> grep <span class="pl-s"><span class="pl-pds">"</span>\-\-service hiveserver2<span class="pl-pds">"</span></span> <span class="pl-k">&gt;</span> /dev/null<span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-k">return</span> 0
    <span class="pl-k">fi</span>
    
    <span class="pl-k">if</span> netstat -tlnp <span class="pl-k">2&gt;</span>/dev/null <span class="pl-k">|</span> grep -q <span class="pl-s"><span class="pl-pds">"</span>:10000<span class="pl-pds">"</span></span><span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-k">return</span> 0
    <span class="pl-k">fi</span>
    
    <span class="pl-k">return</span> 1
}


<span class="pl-c"><span class="pl-c">#</span> 检查 Flink JobManager 进程</span>
<span class="pl-en">check_flink_jobmanager</span>() {
    <span class="pl-k">if</span> jps -l <span class="pl-k">2&gt;</span>/dev/null <span class="pl-k">|</span> grep -q <span class="pl-s"><span class="pl-pds">"</span>org.apache.flink.runtime.entrypoint.StandaloneSessionClusterEntrypoint<span class="pl-pds">"</span></span><span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-k">return</span> 0
    <span class="pl-k">fi</span>
    
    <span class="pl-k">if</span> ps aux <span class="pl-k">|</span> grep -v grep <span class="pl-k">|</span> grep -q <span class="pl-s"><span class="pl-pds">"</span>org.apache.flink.runtime.entrypoint.StandaloneSessionClusterEntrypoint<span class="pl-pds">"</span></span><span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-k">return</span> 0
    <span class="pl-k">fi</span>
    
    <span class="pl-k">if</span> ps aux <span class="pl-k">|</span> grep -v grep <span class="pl-k">|</span> grep -q <span class="pl-s"><span class="pl-pds">"</span>StandaloneSessionClusterEntrypoint<span class="pl-pds">"</span></span><span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-k">return</span> 0
    <span class="pl-k">fi</span>
    
    <span class="pl-k">if</span> netstat -tlnp <span class="pl-k">2&gt;</span>/dev/null <span class="pl-k">|</span> grep -q <span class="pl-s"><span class="pl-pds">"</span>:8081<span class="pl-pds">"</span></span><span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-k">return</span> 0
    <span class="pl-k">fi</span>
    
    <span class="pl-k">if</span> <span class="pl-c1">command</span> -v curl <span class="pl-k">&amp;</span><span class="pl-k">&gt;</span>/dev/null<span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-k">if</span> curl -s -m 3 http://localhost:8081/overview <span class="pl-k">2&gt;</span>/dev/null <span class="pl-k">|</span> grep -q <span class="pl-s"><span class="pl-pds">"</span>taskmanagers<span class="pl-pds">"</span></span><span class="pl-k">;</span> <span class="pl-k">then</span>
            <span class="pl-k">return</span> 0
        <span class="pl-k">fi</span>
    <span class="pl-k">fi</span>
    
    <span class="pl-k">return</span> 1
}


<span class="pl-c"><span class="pl-c">#</span> 检查 Flink TaskManager 进程</span>
<span class="pl-en">check_flink_taskmanager</span>() {
    <span class="pl-k">if</span> jps -l <span class="pl-k">2&gt;</span>/dev/null <span class="pl-k">|</span> grep -q <span class="pl-s"><span class="pl-pds">"</span>org.apache.flink.runtime.taskexecutor.TaskManagerRunner<span class="pl-pds">"</span></span><span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-k">return</span> 0
    <span class="pl-k">fi</span>
    
    <span class="pl-k">if</span> ps aux <span class="pl-k">|</span> grep -v grep <span class="pl-k">|</span> grep -q <span class="pl-s"><span class="pl-pds">"</span>org.apache.flink.runtime.taskexecutor.TaskManagerRunner<span class="pl-pds">"</span></span><span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-k">return</span> 0
    <span class="pl-k">fi</span>
    
    <span class="pl-k">if</span> ps aux <span class="pl-k">|</span> grep -v grep <span class="pl-k">|</span> grep -q <span class="pl-s"><span class="pl-pds">"</span>TaskManagerRunner<span class="pl-pds">"</span></span><span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-k">return</span> 0
    <span class="pl-k">fi</span>
    
    <span class="pl-k">if</span> <span class="pl-c1">command</span> -v curl <span class="pl-k">&amp;</span><span class="pl-k">&gt;</span>/dev/null<span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-k">if</span> curl -s -m 3 http://localhost:8081/taskmanagers <span class="pl-k">2&gt;</span>/dev/null <span class="pl-k">|</span> grep -q <span class="pl-s"><span class="pl-pds">"</span>taskmanagers<span class="pl-pds">"</span></span><span class="pl-k">;</span> <span class="pl-k">then</span>
            <span class="pl-k">if</span> <span class="pl-k">!</span> curl -s -m 3 http://localhost:8081/taskmanagers <span class="pl-k">2&gt;</span>/dev/null <span class="pl-k">|</span> grep -q <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\"</span>taskmanagers<span class="pl-cce">\"</span>:\[\]<span class="pl-pds">"</span></span><span class="pl-k">;</span> <span class="pl-k">then</span>
                <span class="pl-k">return</span> 0
            <span class="pl-k">fi</span>
        <span class="pl-k">fi</span>
    <span class="pl-k">fi</span>
    
    <span class="pl-k">return</span> 1
}


<span class="pl-c"><span class="pl-c">#</span> 通用进程检查函数</span>
<span class="pl-en">check_process</span>() {
    <span class="pl-k">local</span> process_name=<span class="pl-smi">$1</span>
    
    <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$process_name</span><span class="pl-pds">"</span></span> <span class="pl-k">in</span>
        <span class="pl-s"><span class="pl-pds">"</span>HiveMetaStore<span class="pl-pds">"</span></span>)
            check_hive_metastore
            <span class="pl-k">return</span> <span class="pl-smi">$?</span>
            ;;
        <span class="pl-s"><span class="pl-pds">"</span>HiveServer2<span class="pl-pds">"</span></span>)
            check_hiveserver2
            <span class="pl-k">return</span> <span class="pl-smi">$?</span>
            ;;
        <span class="pl-s"><span class="pl-pds">"</span>StandaloneSessionClusterEntrypoint<span class="pl-pds">"</span></span>)
            check_flink_jobmanager
            <span class="pl-k">return</span> <span class="pl-smi">$?</span>
            ;;
        <span class="pl-s"><span class="pl-pds">"</span>TaskManagerRunner<span class="pl-pds">"</span></span>)
            check_flink_taskmanager
            <span class="pl-k">return</span> <span class="pl-smi">$?</span>
            ;;
        <span class="pl-k">*</span>)
            <span class="pl-k">if</span> jps <span class="pl-k">2&gt;</span>/dev/null <span class="pl-k">|</span> grep -i <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$process_name</span><span class="pl-pds">"</span></span> <span class="pl-k">&gt;</span> /dev/null<span class="pl-k">;</span> <span class="pl-k">then</span>
                <span class="pl-k">return</span> 0
            <span class="pl-k">fi</span>
            <span class="pl-k">return</span> 1
            ;;
    esac
}


# 等待进程启动的函数
wait_for_process() {
    <span class="pl-k">local</span> process_name=<span class="pl-smi">$1</span>
    <span class="pl-k">local</span> max_wait=<span class="pl-smi">$2</span>
    <span class="pl-k">local</span> wait_time=0
    
    <span class="pl-c1">echo</span> -ne <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${YELLOW}</span>等待 <span class="pl-smi">$process_name</span> 启动<span class="pl-pds">"</span></span>
    <span class="pl-k">while</span> [ <span class="pl-smi">$wait_time</span> <span class="pl-k">-lt</span> <span class="pl-smi">$max_wait</span> ]<span class="pl-k">;</span> <span class="pl-k">do</span>
        <span class="pl-k">if</span> check_process <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$process_name</span><span class="pl-pds">"</span></span><span class="pl-k">;</span> <span class="pl-k">then</span>
            <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${GREEN}</span> [已启动]<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
            <span class="pl-k">return</span> 0
        <span class="pl-k">fi</span>
        <span class="pl-c1">echo</span> -n <span class="pl-s"><span class="pl-pds">"</span>.<span class="pl-pds">"</span></span>
        sleep 1
        wait_time=<span class="pl-s"><span class="pl-pds">$((</span>wait_time <span class="pl-k">+</span> <span class="pl-c1">1</span><span class="pl-pds">))</span></span>
    <span class="pl-k">done</span>
    
    <span class="pl-k">if</span> check_process <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$process_name</span><span class="pl-pds">"</span></span><span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${GREEN}</span> [已启动]<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
        <span class="pl-k">return</span> 0
    <span class="pl-k">fi</span>
    
    <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${RED}</span> [超时]<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    <span class="pl-k">return</span> 1
}


<span class="pl-c"><span class="pl-c">#</span> 等待进程停止的函数</span>
<span class="pl-en">wait_for_process_stop</span>() {
    <span class="pl-k">local</span> process_name=<span class="pl-smi">$1</span>
    <span class="pl-k">local</span> max_wait=<span class="pl-smi">$2</span>
    <span class="pl-k">local</span> wait_time=0
    
    <span class="pl-c1">echo</span> -ne <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${YELLOW}</span>等待 <span class="pl-smi">$process_name</span> 停止<span class="pl-pds">"</span></span>
    <span class="pl-k">while</span> [ <span class="pl-smi">$wait_time</span> <span class="pl-k">-lt</span> <span class="pl-smi">$max_wait</span> ]<span class="pl-k">;</span> <span class="pl-k">do</span>
        <span class="pl-k">if</span> <span class="pl-k">!</span> check_process <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$process_name</span><span class="pl-pds">"</span></span><span class="pl-k">;</span> <span class="pl-k">then</span>
            <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${GREEN}</span> [已停止]<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
            <span class="pl-k">return</span> 0
        <span class="pl-k">fi</span>
        <span class="pl-c1">echo</span> -n <span class="pl-s"><span class="pl-pds">"</span>.<span class="pl-pds">"</span></span>
        sleep 1
        wait_time=<span class="pl-s"><span class="pl-pds">$((</span>wait_time <span class="pl-k">+</span> <span class="pl-c1">1</span><span class="pl-pds">))</span></span>
    <span class="pl-k">done</span>
    <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${RED}</span> [超时]<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    <span class="pl-k">return</span> 1
}


<span class="pl-c"><span class="pl-c">#</span> 启动组件的函数</span>
<span class="pl-en">start_component</span>() {
    <span class="pl-k">local</span> component=<span class="pl-smi">$1</span>
    <span class="pl-k">local</span> start_cmd=<span class="pl-smi">$2</span>
    <span class="pl-k">local</span> process_check=<span class="pl-smi">$3</span>
    <span class="pl-k">local</span> max_wait=<span class="pl-smi">${4<span class="pl-k">:-</span>30}</span>
    
    <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${BLUE}</span>[<span class="pl-s"><span class="pl-pds">$(</span>date <span class="pl-s"><span class="pl-pds">'</span>+%Y-%m-%d %H:%M:%S<span class="pl-pds">'</span></span><span class="pl-pds">)</span></span>] 正在启动 <span class="pl-smi">$component</span>...<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-s"><span class="pl-pds">$(</span>date <span class="pl-s"><span class="pl-pds">'</span>+%Y-%m-%d %H:%M:%S<span class="pl-pds">'</span></span><span class="pl-pds">)</span></span> - 启动 <span class="pl-smi">$component</span><span class="pl-pds">"</span></span> <span class="pl-k">&gt;&gt;</span> <span class="pl-smi">$LOG_FILE</span>
    
    <span class="pl-k">if</span> check_process <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$process_check</span><span class="pl-pds">"</span></span><span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${GREEN}</span><span class="pl-smi">$component</span> 已经在运行中<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
        <span class="pl-k">return</span> 0
    <span class="pl-k">fi</span>
    
    <span class="pl-c1">eval</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$start_cmd</span><span class="pl-pds">"</span></span> <span class="pl-k">&gt;&gt;</span> <span class="pl-smi">$LOG_FILE</span> <span class="pl-k">2&gt;&amp;1</span>
    <span class="pl-k">local</span> start_result=<span class="pl-smi">$?</span>
    
    <span class="pl-k">if</span> [ <span class="pl-smi">$start_result</span> <span class="pl-k">-ne</span> 0 ]<span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${YELLOW}</span>启动命令返回代码: <span class="pl-smi">$start_result</span>，可能存在问题<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    <span class="pl-k">fi</span>
    
    <span class="pl-k">if</span> wait_for_process <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$process_check</span><span class="pl-pds">"</span></span> <span class="pl-smi">$max_wait</span><span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${GREEN}</span><span class="pl-smi">$component</span> 启动成功<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
        <span class="pl-k">return</span> 0
    <span class="pl-k">else</span>
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${RED}</span><span class="pl-smi">$component</span> 启动超时，但这不一定意味着失败<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
        
        <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$component</span><span class="pl-pds">"</span></span> <span class="pl-k">in</span>
            <span class="pl-s"><span class="pl-pds">"</span>Hive Metastore<span class="pl-pds">"</span></span>|<span class="pl-s"><span class="pl-pds">"</span>HiveServer2<span class="pl-pds">"</span></span>|<span class="pl-s"><span class="pl-pds">"</span>Flink JobManager<span class="pl-pds">"</span></span>)
                <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${YELLOW}</span>正在进行额外检查...<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
                sleep 10
                <span class="pl-k">if</span> check_process <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$process_check</span><span class="pl-pds">"</span></span><span class="pl-k">;</span> <span class="pl-k">then</span>
                    <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${GREEN}</span><span class="pl-smi">$component</span> 已成功启动<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
                    <span class="pl-k">return</span> 0
                <span class="pl-k">fi</span>
                <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${YELLOW}</span>建议手动检查 <span class="pl-smi">$component</span> 状态<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
                ;;
        esac
        
        return 1
    fi
}


# 停止组件的函数
stop_component() {
    <span class="pl-k">local</span> component=<span class="pl-smi">$1</span>
    <span class="pl-k">local</span> stop_cmd=<span class="pl-smi">$2</span>
    <span class="pl-k">local</span> process_check=<span class="pl-smi">$3</span>
    <span class="pl-k">local</span> max_wait=<span class="pl-smi">${4<span class="pl-k">:-</span>30}</span>
    
    <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${BLUE}</span>[<span class="pl-s"><span class="pl-pds">$(</span>date <span class="pl-s"><span class="pl-pds">'</span>+%Y-%m-%d %H:%M:%S<span class="pl-pds">'</span></span><span class="pl-pds">)</span></span>] 正在停止 <span class="pl-smi">$component</span>...<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-s"><span class="pl-pds">$(</span>date <span class="pl-s"><span class="pl-pds">'</span>+%Y-%m-%d %H:%M:%S<span class="pl-pds">'</span></span><span class="pl-pds">)</span></span> - 停止 <span class="pl-smi">$component</span><span class="pl-pds">"</span></span> <span class="pl-k">&gt;&gt;</span> <span class="pl-smi">$LOG_FILE</span>
    
    <span class="pl-k">if</span> <span class="pl-k">!</span> check_process <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$process_check</span><span class="pl-pds">"</span></span><span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${YELLOW}</span><span class="pl-smi">$component</span> 未运行<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
        <span class="pl-k">return</span> 0
    <span class="pl-k">fi</span>
    
    <span class="pl-c1">eval</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$stop_cmd</span><span class="pl-pds">"</span></span> <span class="pl-k">&gt;&gt;</span> <span class="pl-smi">$LOG_FILE</span> <span class="pl-k">2&gt;&amp;1</span>
    
    <span class="pl-k">if</span> wait_for_process_stop <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$process_check</span><span class="pl-pds">"</span></span> <span class="pl-smi">$max_wait</span><span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${GREEN}</span><span class="pl-smi">$component</span> 已成功停止<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
        <span class="pl-k">return</span> 0
    <span class="pl-k">else</span>
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${RED}</span><span class="pl-smi">$component</span> 停止超时，可能需要手动终止进程<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
        <span class="pl-k">return</span> 1
    <span class="pl-k">fi</span>
}


<span class="pl-c"><span class="pl-c">#</span> 获取 PID 函数</span>
<span class="pl-en">get_pid</span>() {
    <span class="pl-k">local</span> process_name=<span class="pl-smi">$1</span>
    <span class="pl-k">local</span> pid=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
    
    <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$process_name</span><span class="pl-pds">"</span></span> <span class="pl-k">in</span>
        <span class="pl-s"><span class="pl-pds">"</span>HiveMetaStore<span class="pl-pds">"</span></span>)
            pid=<span class="pl-s"><span class="pl-pds">$(</span>ps aux <span class="pl-k">|</span> grep -v grep <span class="pl-k">|</span> grep <span class="pl-s"><span class="pl-pds">"</span>org.apache.hadoop.hive.metastore.HiveMetaStore<span class="pl-pds">"</span></span> <span class="pl-k">|</span> awk <span class="pl-s"><span class="pl-pds">'</span>{print $2}<span class="pl-pds">'</span></span> <span class="pl-k">|</span> head -1<span class="pl-pds">)</span></span>
            <span class="pl-k">if</span> [ <span class="pl-k">-z</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$pid</span><span class="pl-pds">"</span></span> ]<span class="pl-k">;</span> <span class="pl-k">then</span>
                pid=<span class="pl-s"><span class="pl-pds">$(</span>ps aux <span class="pl-k">|</span> grep -v grep <span class="pl-k">|</span> grep <span class="pl-s"><span class="pl-pds">"</span>\-\-service metastore<span class="pl-pds">"</span></span> <span class="pl-k">|</span> awk <span class="pl-s"><span class="pl-pds">'</span>{print $2}<span class="pl-pds">'</span></span> <span class="pl-k">|</span> head -1<span class="pl-pds">)</span></span>
            <span class="pl-k">fi</span>
            ;;
        <span class="pl-s"><span class="pl-pds">"</span>HiveServer2<span class="pl-pds">"</span></span>)
            pid=<span class="pl-s"><span class="pl-pds">$(</span>ps aux <span class="pl-k">|</span> grep -v grep <span class="pl-k">|</span> grep <span class="pl-s"><span class="pl-pds">"</span>org.apache.hive.service.server.HiveServer2<span class="pl-pds">"</span></span> <span class="pl-k">|</span> awk <span class="pl-s"><span class="pl-pds">'</span>{print $2}<span class="pl-pds">'</span></span> <span class="pl-k">|</span> head -1<span class="pl-pds">)</span></span>
            <span class="pl-k">if</span> [ <span class="pl-k">-z</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$pid</span><span class="pl-pds">"</span></span> ]<span class="pl-k">;</span> <span class="pl-k">then</span>
                pid=<span class="pl-s"><span class="pl-pds">$(</span>ps aux <span class="pl-k">|</span> grep -v grep <span class="pl-k">|</span> grep <span class="pl-s"><span class="pl-pds">"</span>\-\-service hiveserver2<span class="pl-pds">"</span></span> <span class="pl-k">|</span> awk <span class="pl-s"><span class="pl-pds">'</span>{print $2}<span class="pl-pds">'</span></span> <span class="pl-k">|</span> head -1<span class="pl-pds">)</span></span>
            <span class="pl-k">fi</span>
            ;;
        <span class="pl-s"><span class="pl-pds">"</span>StandaloneSessionClusterEntrypoint<span class="pl-pds">"</span></span>)
            pid=<span class="pl-s"><span class="pl-pds">$(</span>jps -l <span class="pl-k">2&gt;</span>/dev/null <span class="pl-k">|</span> grep <span class="pl-s"><span class="pl-pds">"</span>org.apache.flink.runtime.entrypoint.StandaloneSessionClusterEntrypoint<span class="pl-pds">"</span></span> <span class="pl-k">|</span> awk <span class="pl-s"><span class="pl-pds">'</span>{print $1}<span class="pl-pds">'</span></span> <span class="pl-k">|</span> head -1<span class="pl-pds">)</span></span>
            <span class="pl-k">if</span> [ <span class="pl-k">-z</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$pid</span><span class="pl-pds">"</span></span> ]<span class="pl-k">;</span> <span class="pl-k">then</span>
                pid=<span class="pl-s"><span class="pl-pds">$(</span>ps aux <span class="pl-k">|</span> grep -v grep <span class="pl-k">|</span> grep <span class="pl-s"><span class="pl-pds">"</span>StandaloneSessionClusterEntrypoint<span class="pl-pds">"</span></span> <span class="pl-k">|</span> awk <span class="pl-s"><span class="pl-pds">'</span>{print $2}<span class="pl-pds">'</span></span> <span class="pl-k">|</span> head -1<span class="pl-pds">)</span></span>
            <span class="pl-k">fi</span>
            ;;
        <span class="pl-s"><span class="pl-pds">"</span>TaskManagerRunner<span class="pl-pds">"</span></span>)
            pid=<span class="pl-s"><span class="pl-pds">$(</span>jps -l <span class="pl-k">2&gt;</span>/dev/null <span class="pl-k">|</span> grep <span class="pl-s"><span class="pl-pds">"</span>org.apache.flink.runtime.taskexecutor.TaskManagerRunner<span class="pl-pds">"</span></span> <span class="pl-k">|</span> awk <span class="pl-s"><span class="pl-pds">'</span>{print $1}<span class="pl-pds">'</span></span> <span class="pl-k">|</span> head -1<span class="pl-pds">)</span></span>
            <span class="pl-k">if</span> [ <span class="pl-k">-z</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$pid</span><span class="pl-pds">"</span></span> ]<span class="pl-k">;</span> <span class="pl-k">then</span>
                pid=<span class="pl-s"><span class="pl-pds">$(</span>ps aux <span class="pl-k">|</span> grep -v grep <span class="pl-k">|</span> grep <span class="pl-s"><span class="pl-pds">"</span>TaskManagerRunner<span class="pl-pds">"</span></span> <span class="pl-k">|</span> awk <span class="pl-s"><span class="pl-pds">'</span>{print $2}<span class="pl-pds">'</span></span> <span class="pl-k">|</span> head -1<span class="pl-pds">)</span></span>
            <span class="pl-k">fi</span>
            ;;
        <span class="pl-k">*</span>)
            pid=<span class="pl-s"><span class="pl-pds">$(</span>jps <span class="pl-k">2&gt;</span>/dev/null <span class="pl-k">|</span> grep -i <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$process_name</span><span class="pl-pds">"</span></span> <span class="pl-k">|</span> awk <span class="pl-s"><span class="pl-pds">'</span>{print $1}<span class="pl-pds">'</span></span><span class="pl-pds">)</span></span>
            ;;
    esac
    
    echo <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$pid</span><span class="pl-pds">"</span></span>
}


# 改进的组件状态检查函数
check_component_status() {
    <span class="pl-k">local</span> component=<span class="pl-smi">$1</span>
    <span class="pl-k">local</span> process_check=<span class="pl-smi">$2</span>
    
    <span class="pl-c1">echo</span> -n <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$component</span>: <span class="pl-pds">"</span></span>
    
    <span class="pl-k">if</span> check_process <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$process_check</span><span class="pl-pds">"</span></span><span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-k">local</span> pid=<span class="pl-s"><span class="pl-pds">$(</span>get_pid <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$process_check</span><span class="pl-pds">"</span></span><span class="pl-pds">)</span></span>
        
        <span class="pl-k">if</span> [ <span class="pl-k">!</span> <span class="pl-k">-z</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$pid</span><span class="pl-pds">"</span></span> ]<span class="pl-k">;</span> <span class="pl-k">then</span>
            <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${GREEN}</span>运行中 (PID: <span class="pl-smi">$pid</span>)<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
        <span class="pl-k">else</span>
            <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${GREEN}</span>运行中<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
        <span class="pl-k">fi</span>
    <span class="pl-k">else</span>
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${RED}</span>未运行<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    <span class="pl-k">fi</span>
}


<span class="pl-c"><span class="pl-c">#</span> 启动所有组件</span>
<span class="pl-en">start_all</span>() {
    <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${BLUE}</span>==============================================<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${BLUE}</span>       开始启动所有大数据组件              <span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${BLUE}</span>==============================================<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
    
    <span class="pl-c"><span class="pl-c">#</span> 1. 启动 HDFS</span>
    start_component <span class="pl-s"><span class="pl-pds">"</span>HDFS<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>start-dfs.sh<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>NameNode<span class="pl-pds">"</span></span> 60 <span class="pl-k">||</span> {
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${RED}</span>HDFS 启动失败，终止后续组件启动<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
        <span class="pl-k">return</span> 1
    }
    
    <span class="pl-c"><span class="pl-c">#</span> 检查 HDFS 健康状态</span>
    <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span>检查 HDFS 健康状态...<span class="pl-pds">"</span></span>
    hdfs dfsadmin -report <span class="pl-k">&gt;&gt;</span> <span class="pl-smi">$LOG_FILE</span> <span class="pl-k">2&gt;&amp;1</span>
    <span class="pl-k">if</span> [ <span class="pl-smi">$?</span> <span class="pl-k">-ne</span> 0 ]<span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${RED}</span>HDFS 可能未正常运行，请检查<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    <span class="pl-k">else</span>
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${GREEN}</span>HDFS 运行正常<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    <span class="pl-k">fi</span>
    
    <span class="pl-c"><span class="pl-c">#</span> 2. 启动 YARN</span>
    start_component <span class="pl-s"><span class="pl-pds">"</span>YARN<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>start-yarn.sh<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>ResourceManager<span class="pl-pds">"</span></span> 60 <span class="pl-k">||</span> {
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${YELLOW}</span>YARN 启动失败，但将继续启动其他组件<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    }
    
    <span class="pl-c"><span class="pl-c">#</span> 3. 启动 ZooKeeper</span>
    start_component <span class="pl-s"><span class="pl-pds">"</span>ZooKeeper<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$ZOOKEEPER_HOME</span>/bin/zkServer.sh start<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>QuorumPeerMain<span class="pl-pds">"</span></span> 30 <span class="pl-k">||</span> {
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${YELLOW}</span>ZooKeeper 启动失败，但将继续启动其他组件<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    }
    
    <span class="pl-c"><span class="pl-c">#</span> 4. 启动 Hive Metastore</span>
    start_component <span class="pl-s"><span class="pl-pds">"</span>Hive Metastore<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>nohup hive --service metastore &amp;<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>HiveMetaStore<span class="pl-pds">"</span></span> 60 <span class="pl-k">||</span> {
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${YELLOW}</span>Hive Metastore 启动失败或超时，但将继续启动其他组件<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    }
    
    <span class="pl-c"><span class="pl-c">#</span> 5. 启动 HiveServer2</span>
    start_component <span class="pl-s"><span class="pl-pds">"</span>HiveServer2<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>nohup hive --service hiveserver2 &amp;<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>HiveServer2<span class="pl-pds">"</span></span> 60 <span class="pl-k">||</span> {
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${YELLOW}</span>HiveServer2 启动失败或超时，但将继续启动其他组件<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    }
    
    <span class="pl-c"><span class="pl-c">#</span> 6. 启动 Kafka</span>
    start_component <span class="pl-s"><span class="pl-pds">"</span>Kafka<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$KAFKA_HOME</span>/bin/kafka-server-start.sh -daemon <span class="pl-smi">$KAFKA_HOME</span>/config/server.properties<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>Kafka<span class="pl-pds">"</span></span> 45 <span class="pl-k">||</span> {
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${YELLOW}</span>Kafka 启动失败，但将继续启动其他组件<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    }
    
    <span class="pl-c"><span class="pl-c">#</span> 7. 启动 Flink JobManager (standalone模式)</span>
    start_component <span class="pl-s"><span class="pl-pds">"</span>Flink JobManager<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$FLINK_HOME</span>/bin/start-cluster.sh<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>StandaloneSessionClusterEntrypoint<span class="pl-pds">"</span></span> 60 <span class="pl-k">||</span> {
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${YELLOW}</span>Flink 启动命令执行完成，但进程检测未通过<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
        
        sleep 10
        <span class="pl-k">if</span> check_flink_jobmanager<span class="pl-k">;</span> <span class="pl-k">then</span>
            <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${GREEN}</span>Flink JobManager 已成功启动<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
        <span class="pl-k">else</span>
            <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${YELLOW}</span>Flink JobManager 可能未正常启动，请手动检查<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
        <span class="pl-k">fi</span>
    }
    
    <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
    <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${BLUE}</span>==============================================<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${GREEN}</span>所有组件启动流程已完成<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${BLUE}</span>==============================================<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
}


<span class="pl-c"><span class="pl-c">#</span> 停止所有组件</span>
<span class="pl-en">stop_all</span>() {
    <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${BLUE}</span>==============================================<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${BLUE}</span>       开始停止所有大数据组件              <span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${BLUE}</span>==============================================<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
    
    <span class="pl-c"><span class="pl-c">#</span> 按照与启动相反的顺序停止组件</span>
    
    <span class="pl-c"><span class="pl-c">#</span> 1. 停止 Flink</span>
    stop_component <span class="pl-s"><span class="pl-pds">"</span>Flink<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$FLINK_HOME</span>/bin/stop-cluster.sh<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>StandaloneSessionClusterEntrypoint<span class="pl-pds">"</span></span> 30
    
    <span class="pl-c"><span class="pl-c">#</span> 2. 停止 Kafka</span>
    stop_component <span class="pl-s"><span class="pl-pds">"</span>Kafka<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$KAFKA_HOME</span>/bin/kafka-server-stop.sh<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>Kafka<span class="pl-pds">"</span></span> 30
    
    <span class="pl-c"><span class="pl-c">#</span> 3. 停止 HiveServer2</span>
    stop_component <span class="pl-s"><span class="pl-pds">"</span>HiveServer2<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>pkill -f 'org.apache.hive.service.server.HiveServer2' || pkill -f 'hive --service hiveserver2'<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>HiveServer2<span class="pl-pds">"</span></span> 30
    
    <span class="pl-c"><span class="pl-c">#</span> 4. 停止 Hive Metastore</span>
    stop_component <span class="pl-s"><span class="pl-pds">"</span>Hive Metastore<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>pkill -f 'org.apache.hadoop.hive.metastore.HiveMetaStore' || pkill -f 'hive --service metastore'<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>HiveMetaStore<span class="pl-pds">"</span></span> 30
    
    <span class="pl-c"><span class="pl-c">#</span> 5. 停止 ZooKeeper</span>
    stop_component <span class="pl-s"><span class="pl-pds">"</span>ZooKeeper<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$ZOOKEEPER_HOME</span>/bin/zkServer.sh stop<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>QuorumPeerMain<span class="pl-pds">"</span></span> 30
    
    <span class="pl-c"><span class="pl-c">#</span> 6. 停止 YARN</span>
    stop_component <span class="pl-s"><span class="pl-pds">"</span>YARN<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>stop-yarn.sh<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>ResourceManager<span class="pl-pds">"</span></span> 60
    
    <span class="pl-c"><span class="pl-c">#</span> 7. 停止 HDFS</span>
    stop_component <span class="pl-s"><span class="pl-pds">"</span>HDFS<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>stop-dfs.sh<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>NameNode<span class="pl-pds">"</span></span> 60
    
    <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
    <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${BLUE}</span>==============================================<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${GREEN}</span>所有组件停止流程已完成<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${BLUE}</span>==============================================<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
}


<span class="pl-c"><span class="pl-c">#</span> 显示所有组件状态</span>
<span class="pl-en">show_status</span>() {
    <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${BLUE}</span>==============================================<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${BLUE}</span>       大数据组件运行状态              <span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${BLUE}</span>==============================================<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
    
    check_component_status <span class="pl-s"><span class="pl-pds">"</span>NameNode<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>NameNode<span class="pl-pds">"</span></span>
    check_component_status <span class="pl-s"><span class="pl-pds">"</span>DataNode<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>DataNode<span class="pl-pds">"</span></span>
    check_component_status <span class="pl-s"><span class="pl-pds">"</span>ResourceManager<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>ResourceManager<span class="pl-pds">"</span></span>
    check_component_status <span class="pl-s"><span class="pl-pds">"</span>NodeManager<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>NodeManager<span class="pl-pds">"</span></span>
    check_component_status <span class="pl-s"><span class="pl-pds">"</span>ZooKeeper<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>QuorumPeerMain<span class="pl-pds">"</span></span>
    check_component_status <span class="pl-s"><span class="pl-pds">"</span>Hive Metastore<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>HiveMetaStore<span class="pl-pds">"</span></span>
    check_component_status <span class="pl-s"><span class="pl-pds">"</span>HiveServer2<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>HiveServer2<span class="pl-pds">"</span></span>
    check_component_status <span class="pl-s"><span class="pl-pds">"</span>Kafka<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>Kafka<span class="pl-pds">"</span></span>
    check_component_status <span class="pl-s"><span class="pl-pds">"</span>Flink JobManager<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>StandaloneSessionClusterEntrypoint<span class="pl-pds">"</span></span>
    check_component_status <span class="pl-s"><span class="pl-pds">"</span>Flink TaskManager<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>TaskManagerRunner<span class="pl-pds">"</span></span>
    
    <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
    <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${BLUE}</span>==============================================<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
    
    <span class="pl-c"><span class="pl-c">#</span> 显示 Flink REST API 状态</span>
    <span class="pl-k">if</span> <span class="pl-c1">command</span> -v curl <span class="pl-k">&amp;</span><span class="pl-k">&gt;</span>/dev/null<span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${YELLOW}</span>Flink REST API 状态:<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
        <span class="pl-k">if</span> curl -s -m 3 http://localhost:8081/overview <span class="pl-k">2&gt;</span>/dev/null <span class="pl-k">|</span> grep -q <span class="pl-s"><span class="pl-pds">"</span>taskmanagers<span class="pl-pds">"</span></span><span class="pl-k">;</span> <span class="pl-k">then</span>
            <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${GREEN}</span>Flink REST API 正常响应<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
        <span class="pl-k">else</span>
            <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${RED}</span>Flink REST API 无响应<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
        <span class="pl-k">fi</span>
    <span class="pl-k">fi</span>
}


<span class="pl-c"><span class="pl-c">#</span> 检查环境变量</span>
<span class="pl-en">check_env</span>() {
    <span class="pl-k">local</span> missing_vars=0
    
    <span class="pl-k">if</span> [ <span class="pl-k">-z</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$ZOOKEEPER_HOME</span><span class="pl-pds">"</span></span> ]<span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${YELLOW}</span>警告: ZOOKEEPER_HOME 环境变量未设置<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
        missing_vars=1
    <span class="pl-k">fi</span>
    
    <span class="pl-k">if</span> [ <span class="pl-k">-z</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$KAFKA_HOME</span><span class="pl-pds">"</span></span> ]<span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${YELLOW}</span>警告: KAFKA_HOME 环境变量未设置<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
        missing_vars=1
    <span class="pl-k">fi</span>
    
    <span class="pl-k">if</span> [ <span class="pl-k">-z</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$FLINK_HOME</span><span class="pl-pds">"</span></span> ]<span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${YELLOW}</span>警告: FLINK_HOME 环境变量未设置<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
        missing_vars=1
    <span class="pl-k">fi</span>
    
    <span class="pl-k">if</span> [ <span class="pl-smi">$missing_vars</span> <span class="pl-k">-eq</span> 1 ]<span class="pl-k">;</span> <span class="pl-k">then</span>
        <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${YELLOW}</span>请设置必要的环境变量或修改脚本中的路径<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
        <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
        
        <span class="pl-k">if</span> [ <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$ACTION</span><span class="pl-pds">"</span></span> <span class="pl-k">!=</span> <span class="pl-s"><span class="pl-pds">"</span>status<span class="pl-pds">"</span></span> ]<span class="pl-k">;</span> <span class="pl-k">then</span>
            <span class="pl-c1">echo</span> -n -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${YELLOW}</span>是否继续执行? (y/n): <span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
            <span class="pl-c1">read</span> -r confirm
            <span class="pl-k">if</span> [[ <span class="pl-k">!</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$confirm</span><span class="pl-pds">"</span></span> <span class="pl-k">=~</span> ^[Yy]$ ]]<span class="pl-k">;</span> <span class="pl-k">then</span>
                <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${RED}</span>操作已取消<span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
                <span class="pl-c1">exit</span> 1
            <span class="pl-k">fi</span>
        <span class="pl-k">fi</span>
    <span class="pl-k">fi</span>
}


<span class="pl-c"><span class="pl-c">#</span> 主函数</span>
<span class="pl-en">main</span>() {
    <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$ACTION</span><span class="pl-pds">"</span></span> <span class="pl-k">in</span>
        start)
            start_all
            ;;
        stop)
            stop_all
            ;;
        status)
            show_status
            ;;
        <span class="pl-k">*</span>)
            <span class="pl-c1">echo</span> -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${RED}</span>不支持的操作: <span class="pl-smi">$ACTION</span><span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
            <span class="pl-c1">exit</span> 1
            ;;
    esac
    
    echo <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
    echo -e <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${YELLOW}</span>日志文件: <span class="pl-smi">$LOG_FILE</span><span class="pl-smi">${NC}</span><span class="pl-pds">"</span></span>
}


# 检查环境变量
check_env


# 执行主函数
main
</pre></div>
<p>使用方式：<br>
保存为了bigdata.sh</p>
<p>加入环境变量</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">mkdir <span class="pl-k">~</span>/bin
mv bigdata.sh <span class="pl-k">~</span>/bin/bigdata
chmod +x <span class="pl-k">~</span>/bin/bigdata
<span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>export PATH="$HOME/bin:$PATH"<span class="pl-pds">'</span></span> <span class="pl-k">&gt;&gt;</span> <span class="pl-k">~</span>/.bashrc</pre></div>
<p>使更改生效</p>
<div class="highlight highlight-source-scala"><pre class="notranslate">source <span class="pl-k">~/</span>.bashrc</pre></div>
<p>测试命令</p>
<div class="highlight highlight-source-scala"><pre class="notranslate">bigdata start</pre></div>
<p>至此，安装全部结束！Happy Coding!</p>
<p>2025年4月20日</p></div>
<div style="font-size:small;margin-top:8px;float:right;"></div>

<button class="btn btn-block" type="button" onclick="openComments()" id="cmButton">评论</button>
<div class="comments" id="comments"></div>

</div>
    <div id="footer"><div id="footer1">Copyright © <span id="copyrightYear"></span> <a href="http://sean-xia.github.io">Summer</a></div>
<div id="footer2">
    <span id="runday"></span><span>Powered by <a href="https://meekdai.com/Gmeek.html" target="_blank">Gmeek</a></span>
</div>

<script>
var now=new Date();
document.getElementById("copyrightYear").innerHTML=now.getFullYear();

if(""!=""){
    var startSite=new Date("");
    var diff=now.getTime()-startSite.getTime();
    var diffDay=Math.floor(diff/(1000*60*60*24));
    document.getElementById("runday").innerHTML="网站运行"+diffDay+"天"+" • ";
}
</script></div>
</body>
<script>
var IconList={'sun': 'M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z', 'moon': 'M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z', 'sync': 'M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z', 'home': 'M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z', 'github': 'M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z', 'copy': 'M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z', 'check': 'M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z'};
var utterancesLoad=0;

let themeSettings={
    "dark": ["dark","moon","#00f0ff","dark-blue"],
    "light": ["light","sun","#ff5000","github-light"],
    "auto": ["auto","sync","","preferred-color-scheme"]
};
function changeTheme(mode, icon, color, utheme){
    document.documentElement.setAttribute("data-color-mode",mode);
    document.getElementById("themeSwitch").setAttribute("d",value=IconList[icon]);
    document.getElementById("themeSwitch").parentNode.style.color=color;
    if(utterancesLoad==1){utterancesTheme(utheme);}
}
function modeSwitch(){
    let currentMode=document.documentElement.getAttribute('data-color-mode');
    let newMode = currentMode === "light" ? "dark" : currentMode === "dark" ? "auto" : "light";
    localStorage.setItem("meek_theme", newMode);
    if(themeSettings[newMode]){
        changeTheme(...themeSettings[newMode]);
    }
}
function utterancesTheme(theme){
    const message={type:'set-theme',theme: theme};
    const iframe=document.getElementsByClassName('utterances-frame')[0];
    iframe.contentWindow.postMessage(message,'https://utteranc.es');
}
if(themeSettings[theme]){changeTheme(...themeSettings[theme]);}
console.log("\n %c Gmeek last https://github.com/Meekdai/Gmeek \n","padding:5px 0;background:#02d81d;color:#fff");
</script>

<script>
document.getElementById("pathHome").setAttribute("d",IconList["home"]);
document.getElementById("pathIssue").setAttribute("d",IconList["github"]);



function openComments(){
    cm=document.getElementById("comments");
    cmButton=document.getElementById("cmButton");
    cmButton.innerHTML="loading";
    span=document.createElement("span");
    span.setAttribute("class","AnimatedEllipsis");
    cmButton.appendChild(span);

    script=document.createElement("script");
    script.setAttribute("src","https://utteranc.es/client.js");
    script.setAttribute("repo","sean-xia/sean-xia.github.io");
    script.setAttribute("issue-term","title");
    
    if(localStorage.getItem("meek_theme")=="dark"){script.setAttribute("theme","dark-blue");}
    else if(localStorage.getItem("meek_theme")=="light") {script.setAttribute("theme","github-light");}
    else{script.setAttribute("theme","preferred-color-scheme");}
    
    script.setAttribute("crossorigin","anonymous");
    script.setAttribute("async","");
    cm.appendChild(script);

    int=self.setInterval("iFrameLoading()",200);
}

function iFrameLoading(){
    var utterances=document.getElementsByClassName('utterances');
    if(utterances.length==1){
        if(utterances[0].style.height!=""){
            utterancesLoad=1;
            int=window.clearInterval(int);
            document.getElementById("cmButton").style.display="none";
            console.log("utterances Load OK");
        }
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const createClipboardHTML = (codeContent, additionalClasses = '') => `
        <pre class="notranslate"><code class="notranslate">${codeContent}</code></pre>
        <div class="clipboard-container position-absolute right-0 top-0 ${additionalClasses}">
            <clipboard-copy class="ClipboardButton btn m-2 p-0" role="button" style="display: inherit;">
                <svg height="16" width="16" class="octicon octicon-copy m-2"><path d="${IconList["copy"]}"></path></svg>
                <svg height="16" width="16" class="octicon octicon-check color-fg-success m-2 d-none"><path d="${IconList["check"]}"></path></svg>
            </clipboard-copy>
            <div class="copy-feedback">Copied!</div>
        </div>
    `;

    const handleCodeElements = (selector = '') => {
        document.querySelectorAll(selector).forEach(codeElement => {
            const codeContent = codeElement.innerHTML;
            const newStructure = document.createElement('div');
            newStructure.className = 'snippet-clipboard-content position-relative overflow-auto';
            newStructure.innerHTML = createClipboardHTML(codeContent);

            const parentElement = codeElement.parentElement;
            if (selector.includes('highlight')) {
                parentElement.insertBefore(newStructure, codeElement.nextSibling);
                parentElement.removeChild(codeElement);
            } else {
                parentElement.parentElement.replaceChild(newStructure, parentElement);
            }
        });
    };

    handleCodeElements('pre.notranslate > code.notranslate');
    handleCodeElements('div.highlight > pre.notranslate');

    let currentFeedback = null;
    document.querySelectorAll('clipboard-copy').forEach(copyButton => {
        copyButton.addEventListener('click', () => {
            const codeContent = copyButton.closest('.snippet-clipboard-content').innerText;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = codeContent;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);

            const copyIcon = copyButton.querySelector('.octicon-copy');
            const checkIcon = copyButton.querySelector('.octicon-check');
            const copyFeedback = copyButton.nextElementSibling;

            if (currentFeedback && currentFeedback !== copyFeedback) {currentFeedback.style.display = 'none';}
            currentFeedback = copyFeedback;

            copyIcon.classList.add('d-none');
            checkIcon.classList.remove('d-none');
            copyFeedback.style.display = 'block';
            copyButton.style.borderColor = 'var(--color-success-fg)';

            setTimeout(() => {
                copyIcon.classList.remove('d-none');
                checkIcon.classList.add('d-none');
                copyFeedback.style.display = 'none';
                copyButton.style.borderColor = '';
            }, 2000);
        });
    });
});

</script>


</html>
